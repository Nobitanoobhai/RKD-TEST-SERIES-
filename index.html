<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>Student Exam Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --primary: #4f46e5;
            --secondary: #9333ea;
            --success: #16a34a;
            --danger: #dc2626;
            --border: #e2e8f0;
            --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        
        /* SCROLL ALLOWED, ZOOM BLOCKED */
        html { height: 100%; overflow: hidden; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-color); 
            color: var(--text-main); 
            margin: 0; 
            height: 100%;
            touch-action: pan-y; /* Vertical scroll OK, Zoom NO */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .container { max-width: 500px; margin: 0 auto; padding: 15px; padding-bottom: 80px; }
        
        .view { 
            display: none; 
            background: white; 
            padding: 25px; 
            border-radius: 16px; 
            box-shadow: var(--card-shadow); 
            border: 1px solid var(--border);
            text-align: center; 
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .active { display: block; }
        @keyframes popIn { from { opacity:0; transform:scale(0.98); } to { opacity:1; transform:scale(1); } }

        h1, h2, h3 { margin-top: 0; font-weight: 700; letter-spacing: -0.025em; }
        
        input { 
            width: 100%; padding: 14px; margin: 8px 0; 
            border: 1px solid var(--border); 
            background: #f1f5f9;
            border-radius: 10px; color: var(--text-main);
            font-size: 16px; outline: none; transition: border 0.1s; 
            font-family: inherit;
        }
        input:focus { border-color: var(--primary); background: white; }
        
        button { 
            width: 100%; padding: 14px; 
            background: var(--primary); 
            color: white; border: none; border-radius: 10px; 
            font-size: 15px; font-weight: 600; cursor: pointer; 
            margin-top: 15px; 
            transition: transform 0.05s; 
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
        }
        button:active { transform: scale(0.96); }
        button:disabled { background: #cbd5e1; transform: none; box-shadow: none; }
        
        .dash-card {
            text-align: left; padding: 20px; border-radius: 12px;
            margin-bottom: 15px; cursor: pointer; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.1s;
            position: relative; overflow: hidden;
        }
        .dash-card:active { transform: scale(0.98); }
        .dash-card h3 { margin: 0; font-size: 18px; }
        .dash-card p { margin: 5px 0 0 0; font-size: 13px; opacity: 0.9; }
        
        .card-schedule { background: linear-gradient(135deg, #3b82f6, #2563eb); } 
        .card-history { background: linear-gradient(135deg, #8b5cf6, #7c3aed); } 
        .card-logout { background: white; border: 1px solid #fee2e2; color: var(--danger); text-align: center; padding: 12px; }

        .question-box { text-align: left; border-bottom: 1px solid var(--border); padding: 20px 0; }
        .q-img { max-width: 100%; border-radius: 8px; margin: 10px 0; border: 1px solid var(--border); }
        
        .opt-label { 
            display: flex; align-items: center; padding: 12px; 
            background: #fff; border: 1px solid var(--border); 
            border-radius: 10px; margin-top: 8px; 
            cursor: pointer; transition: 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .opt-label:active { background: #f8fafc; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + span { color: var(--primary); font-weight: 600; }
        .opt-label:has(input:checked) { border-color: var(--primary); background: #eef2ff; box-shadow: 0 0 0 1px var(--primary); }

        #timer-float { 
            position: fixed; top: 15px; right: 15px; 
            background: #1e293b; color: #fff; 
            padding: 8px 16px; border-radius: 20px; 
            font-weight: 700; font-family: monospace; z-index: 100; 
            display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(3px); }
        .modal.show { display: flex; } 
        
        .modal-content { 
            background: white; width: 90%; max-width: 450px; max-height: 80vh; 
            overflow-y: auto; border-radius: 14px; padding: 20px; text-align: left; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); 
            animation: slideUp 0.15s ease-out;
        }
        @keyframes slideUp { from { transform:translateY(20px); opacity:0; } to { transform:translateY(0); opacity:1; } }
        
        .list-item { padding: 12px; border-bottom: 1px solid var(--border); }
        
        .alert-box { background: white; padding: 25px; border-radius: 14px; text-align: center; width: 80%; max-width: 300px; animation: popIn 0.15s; }
        .alert-btns { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn-alert { margin: 0; padding: 10px 20px; width: auto; }
        .btn-cancel { background: #f1f5f9; color: var(--text-main); }
        
        .btn-refresh-float {
            width: 100%; background: #e2e8f0; color: #334155; margin-bottom: 20px;
            font-size: 14px; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
    </style>
</head>
<body oncontextmenu="return false;"> 

    <div id="timer-float">00:00</div>

    <div id="custom-alert" class="modal">
        <div class="alert-box">
            <h3 id="alert-text" style="margin-bottom:10px;">Message</h3>
            <div class="alert-btns">
                <button id="alert-cancel" class="btn-alert btn-cancel">Cancel</button>
                <button id="alert-ok" class="btn-alert">OK</button>
            </div>
        </div>
    </div>

    <div class="container">

        <div id="view-login" class="view active">
            <h1 style="color:var(--primary); margin-bottom:5px;">Student Portal</h1>
            <p style="color:var(--text-muted); font-size:14px;">Please login to continue</p>
            <input type="text" id="login-name" placeholder="Full Name" oninput="saveDraft('name', this.value)">
            <input type="text" id="login-roll" placeholder="Roll Number" oninput="saveDraft('roll', this.value)">
            <input type="password" id="login-code" placeholder="Secret Code" oninput="saveDraft('code', this.value)">
            <button onclick="handleLogin()" id="login-btn">Secure Login üîê</button>
        </div>

        <div id="view-dashboard" class="view">
            <button class="btn-refresh-float" onclick="location.reload()">‚Üª Refresh Portal</button>
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0;">Hi, <span id="dash-name" style="color:var(--primary);">Student</span></h2>
                <div style="font-size:12px; background:#e0e7ff; color:var(--primary); padding:4px 8px; border-radius:20px; font-weight:600;">Online</div>
            </div>
            <div style="background:#f8fafc; border:1px dashed #cbd5e1; padding:15px; border-radius:10px; margin-bottom:20px;">
                <p style="margin:0; font-size:13px; color:var(--text-muted);">
                    ‚è≥ Status: <strong id="exam-status-text">Waiting for Teacher...</strong>
                </p>
            </div>
            <div class="dash-card card-schedule" onclick="openSchedule()"><h3>üìÖ Exam Schedule</h3><p>Check upcoming test dates & times</p></div>
            <div class="dash-card card-history" onclick="openHistory()"><h3>üìú Past Results</h3><p>View your performance history</p></div>
            <div class="dash-card card-logout" onclick="handleLogout()">Log Out</div>
        </div>

        <div id="view-exam" class="view" style="max-width: 600px; padding: 20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding-bottom:10px;">
                <h3 id="exam-title" style="margin:0;">Exam</h3>
                <span style="font-size:11px; color:var(--danger); font-weight:bold;">‚ö†Ô∏è NO TAB SWITCHING</span>
            </div>
            <div id="questions-area"></div>
            <button onclick="submitExam()">Submit Final Answers ‚úÖ</button>
        </div>

        <div id="view-result" class="view">
            <div style="width:80px; height:80px; background:#dcfce7; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px auto;">
                <span style="font-size:30px;">üéâ</span>
            </div>
            <h2 style="color:var(--success);">Exam Submitted!</h2>
            <div style="font-size:36px; font-weight:800; color:#166534; margin:10px 0;">
                <span id="res-score">0</span><span style="font-size:20px; color:#86efac;">/</span><span id="res-total" style="font-size:20px; color:#166534;">0</span>
            </div>
            <p style="font-size:13px;">Returning to dashboard in <span id="redirect-time">10</span>s</p>
        </div>

    </div>

    <div id="modal-list" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3 id="modal-title">List</h3>
                <button onclick="closeModal()" style="width:auto; padding:5px 10px; font-size:12px; margin:0; background:#f1f5f9; color:black;">Close</button>
            </div>
            <div id="modal-body">Loading...</div>
        </div>
    </div>

    <script>
        // --- DISABLE ZOOM & SCROLL SHORTCUTS ---
        document.addEventListener('gesturestart', function(e) { e.preventDefault(); });
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && (event.key === '+' || event.key === '-' || event.key === '=')) {
                event.preventDefault();
            }
        });

        // --- CONFIG ---
        const SUPABASE_URL = 'https://byezxlkkckbliduofdco.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5ZXp4bGtrY2tibGlkdW9mZGNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMzQ2MjUsImV4cCI6MjA3OTcxMDYyNX0._HEdU0IxVH4RPsdejJsY5gd9uKO7fdaNTILYxhXaZl0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let examQuestions = [];
        let examTimer = null;
        let currentExamName = "Exam";
        let redirectIntv = null;
        
        // --- PERSISTENCE ---
        function saveDraft(key, val) { localStorage.setItem('draft_'+key, val); }
        function loadDrafts() {
            if(localStorage.getItem('draft_name')) document.getElementById('login-name').value = localStorage.getItem('draft_name');
            if(localStorage.getItem('draft_roll')) document.getElementById('login-roll').value = localStorage.getItem('draft_roll');
            if(localStorage.getItem('draft_code')) document.getElementById('login-code').value = localStorage.getItem('draft_code');
        }
        function clearDrafts() { localStorage.removeItem('draft_name'); localStorage.removeItem('draft_roll'); localStorage.removeItem('draft_code'); }
        function saveAnswerLocal(qId, val) { let answers = JSON.parse(localStorage.getItem('exam_backup') || '{}'); answers[qId] = val; localStorage.setItem('exam_backup', JSON.stringify(answers)); }
        function loadAnswersLocal() { let answers = JSON.parse(localStorage.getItem('exam_backup') || '{}'); for (const [qId, val] of Object.entries(answers)) { const el = document.querySelector(`input[name="q_${qId}"][value="${val}"]`); if(el) el.checked = true; } }

        // --- INIT ---
        window.onload = async () => {
            loadDrafts(); 
            const uid = localStorage.getItem('student_id');
            if(uid) {
                const { data } = await supabase.from('students').select('*').eq('id', uid).single();
                if(data && data.is_online) successLogin(data);
                else {
                    localStorage.removeItem('student_id');
                }
            }
        };

        // --- AUTH ---
        async function handleLogin() {
            const name = document.getElementById('login-name').value.trim();
            const roll = document.getElementById('login-roll').value.trim();
            const code = document.getElementById('login-code').value.trim();
            const btn = document.getElementById('login-btn');

            if (!name || !roll || !code) return showAlert("Please fill all fields!");
            btn.disabled = true; btn.innerText = "Verifying...";

            try {
                let { data: existing } = await supabase.from('students').select('*').eq('roll_no', roll).single();
                if (existing) {
                    if (existing.secret_code === code) {
                        await supabase.from('students').update({ is_online: true, name: name }).eq('id', existing.id);
                        existing.name = name;
                        successLogin(existing);
                    } else { showAlert("‚ùå Invalid Code"); btn.disabled = false; btn.innerText = "Secure Login üîê"; }
                } else {
                    const { data, error } = await supabase.from('students').insert({ name: name, roll_no: roll, secret_code: code, is_online: true }).select().single();
                    if (error) throw error;
                    successLogin(data);
                }
            } catch (err) { showAlert("Error: " + err.message); btn.disabled = false; btn.innerText = "Secure Login üîê"; }
        }

        function successLogin(user) {
            clearDrafts(); currentUser = user; localStorage.setItem('student_id', user.id);
            document.getElementById('dash-name').innerText = user.name.split(' ')[0];
            switchView('view-dashboard');
            checkExamStatus(); // Initial Check
            setupRealtime();   // Start Listening
        }

        async function handleLogout(forced = false) {
            if(redirectIntv) clearInterval(redirectIntv);
            if(currentUser && !forced) await supabase.from('students').update({ is_online: false }).eq('id', currentUser.id);
            localStorage.removeItem('student_id'); 
            localStorage.removeItem('exam_backup'); 
            currentUser = null;
            switchView('view-login');
            if(forced) showAlert("‚ö†Ô∏è Session Ended (Logged out by Admin)");
            document.getElementById('login-btn').disabled = false; document.getElementById('login-btn').innerText = "Secure Login üîê";
        }

        // --- EXAM LOGIC & REALTIME SYNC ---
        function setupRealtime() {
            supabase.channel('student_chan').on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'exam_state' }, payload => {
                
                // 1. If Exam Starts -> Try to Join
                if(payload.new.status === 'started') {
                    checkExamStatus(); 
                }
                
                // 2. If Exam Ends (Stopped by Teacher) -> Force everyone to Dashboard (Auto Update)
                if(payload.new.status === 'ended') {
                    console.log("Teacher Stopped Exam");
                    
                    // If student was inside exam, force submit/close
                    if(document.getElementById('view-exam').classList.contains('active')) {
                        forceSubmit(false); // Submit current answers
                        showAlert("üõë Teacher stopped the exam.");
                    } else {
                        // If on dashboard, just update text
                        document.getElementById('exam-status-text').innerText = "Waiting for Teacher...";
                    }
                }
                
            }).on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'students' }, payload => {
                if(currentUser && payload.new.id === currentUser.id && !payload.new.is_online) handleLogout(true);
            }).subscribe();
        }

        async function checkExamStatus() {
            const { data } = await supabase.from('exam_state').select('*').eq('id', 1).single();
            if(data && data.status === 'started') startExam(data);
            else document.getElementById('exam-status-text').innerText = "Waiting for Teacher...";
        }

        // ---------- BULLETPROOF ENTRY CHECK ----------
        async function startExam(state) {
            // NOTE: We check history EVEN IF we are already on the dashboard to update text
            
            // 1. REFRESH/RE-ENTRY CHECK: Did I already finish this specific exam?
            const { data: history } = await supabase.from('exam_history')
                .select('id')
                .eq('student_roll', currentUser.roll_no)
                .eq('exam_name', state.exam_name) 
                .limit(1);

            // 2. IF HISTORY EXISTS -> BLOCK & SHOW STATUS
            if (history && history.length > 0) {
                // IMPORTANT: Show that exam is running globally, but USER is blocked
                document.getElementById('exam-status-text').innerText = "‚ö†Ô∏è Exam is Running (You are Disqualified/Submitted)";
                
                // If they tried to refresh while inside, kick them out
                if(document.getElementById('view-exam').classList.contains('active')) {
                    switchView('view-dashboard');
                }
                
                // Show Popup ONLY if they just refreshed trying to sneak in
                // (We can assume if this function runs and view-dashboard is active, they just loaded)
                if(document.getElementById('view-dashboard').classList.contains('active')) {
                   // Optional: Only alert if needed, or just let the text speak
                   // showAlert("‚ö†Ô∏è You have already completed/DQ'd from this exam.");
                }
                
                return; // STOP. DO NOT LOAD QUESTIONS.
            }
            
            // 3. IF NO HISTORY -> Safe to Enter
            if(document.getElementById('view-exam').classList.contains('active')) return; // Already in

            enableAntiCheat();
            currentExamName = state.exam_name;
            document.getElementById('exam-title').innerText = currentExamName;
            document.getElementById('exam-status-text').innerText = "üî• Exam in Progress...";
            
            if(state.linked_queue_id) {
                const { data } = await supabase.from('exam_queue').select('question_snapshot').eq('id', state.linked_queue_id).single();
                examQuestions = (data && data.question_snapshot) ? data.question_snapshot : [];
            } else {
                const { data } = await supabase.from('questions').select('*').is('queue_id', null);
                examQuestions = data || [];
            }
            
            const div = document.getElementById('questions-area');
            if(!examQuestions || examQuestions.length === 0) {
                div.innerHTML = "<div style='text-align:center; padding:20px; color:gray;'>No questions found. Waiting...</div>";
            } else {
                div.innerHTML = examQuestions.map((q, i) => `
                    <div class="question-box">
                        <p style="font-weight:600; margin-bottom:10px;">Q${i+1}. ${q.question_text}</p>
                        ${q.image_url ? `<img src="${q.image_url}" class="q-img">` : ''}
                        <label class="opt-label"><input type="radio" name="q_${q.id}" value="A" onchange="saveAnswerLocal('${q.id}', 'A')"> <span>A) ${q.option_a}</span></label>
                        <label class="opt-label"><input type="radio" name="q_${q.id}" value="B" onchange="saveAnswerLocal('${q.id}', 'B')"> <span>B) ${q.option_b}</span></label>
                        <label class="opt-label"><input type="radio" name="q_${q.id}" value="C" onchange="saveAnswerLocal('${q.id}', 'C')"> <span>C) ${q.option_c}</span></label>
                        <label class="opt-label"><input type="radio" name="q_${q.id}" value="D" onchange="saveAnswerLocal('${q.id}', 'D')"> <span>D) ${q.option_d}</span></label>
                    </div>
                `).join('');
            }

            switchView('view-exam');
            loadAnswersLocal(); 
            
            const end = new Date(state.start_time).getTime() + (state.duration_minutes * 60000);
            document.getElementById('timer-float').style.display = 'block';
            if(examTimer) clearInterval(examTimer);
            examTimer = setInterval(() => {
                const diff = end - new Date().getTime();
                if (diff <= 0) { clearInterval(examTimer); forceSubmit(); }
                else {
                    const m = Math.floor(diff/60000); const s = Math.floor((diff%60000)/1000);
                    document.getElementById('timer-float').innerText = `${m}:${s<10?'0'+s:s}`;
                }
            }, 1000);
        }

        async function submitExam(auto = false) {
            if(!auto && !await showConfirm("Submit Answers?")) return;
            processResult(false);
        }

        // ---------- STRICT ANTI-CHEAT ----------
        async function forceSubmit(cheat = false) {
            // Stop everything
            clearInterval(examTimer); 
            disableAntiCheat();
            document.getElementById('timer-float').style.display = 'none';

            // If forced by teacher stop, just submit normal
            // If cheat, pass true
            processResult(cheat);
        }

        async function processResult(isDQ = false) {
            let score = 0, details = [];
            
            // Calculate Score (only if not DQ and questions loaded)
            if(!isDQ && examQuestions.length > 0) {
                examQuestions.forEach(q => {
                    const ans = document.querySelector(`input[name="q_${q.id}"]:checked`)?.value || "Skipped";
                    const correct = (ans === q.correct_option);
                    if(correct) score++;
                    details.push({ question: q.question_text, img: q.image_url, user: ans, real: q.correct_option, is_correct: correct });
                });
            } else if (isDQ) {
                details = [{ question: "System", user: "Disqualified (Tab Switch)", real: "-", is_correct: false }];
            } else {
                // Teacher stopped exam manually
                 details = [{ question: "System", user: "Exam Stopped by Teacher", real: "-", is_correct: false }];
            }

            // INSERT INTO DB IMMEDIATELY (Locks the refresh loophole)
            await supabase.from('exam_history').insert({
                student_name: currentUser.name, student_roll: currentUser.roll_no, secret_code: currentUser.secret_code,
                exam_name: currentExamName + (isDQ?" (DQ)":""), score: score, total_marks: examQuestions.length, full_details: details
            });

            localStorage.removeItem('exam_backup'); 
            
            // UI HANDLING
            if(isDQ) {
                // If Cheating -> KICK TO DASHBOARD
                await showAlert("‚ö†Ô∏è Cheating Detected! Exam Disqualified.");
                document.getElementById('exam-status-text').innerText = "üö´ Disqualified (Exam Running)";
                switchView('view-dashboard');
            } else {
                // Normal Submit or Time Up
                document.getElementById('res-score').innerText = score; document.getElementById('res-total').innerText = examQuestions.length;
                switchView('view-result');
                document.getElementById('exam-status-text').innerText = "‚úÖ Exam Submitted";
                
                let t = 10;
                redirectIntv = setInterval(() => {
                    t--; document.getElementById('redirect-time').innerText = t;
                    if(t<=0) { clearInterval(redirectIntv); switchView('view-dashboard'); }
                }, 1000);
            }
        }

        function enableAntiCheat() {
            document.documentElement.requestFullscreen().catch(e=>{});
            document.addEventListener("visibilitychange", checkTab);
        }
        function disableAntiCheat() {
            document.removeEventListener("visibilitychange", checkTab);
            if(document.fullscreenElement) document.exitFullscreen().catch(e=>{});
        }
        
        function checkTab() {
            if(document.hidden) {
                forceSubmit(true); // 0 WARNINGS = KICK
            }
        }

        async function openSchedule() {
            showModal('üìÖ Exam Schedule', 'Loading...');
            const { data } = await supabase.from('exam_queue').select('*').eq('status', 'pending').order('scheduled_at', {ascending: true});
            const html = (data && data.length) ? data.map(ex => `
                <div class="list-item">
                    <div style="font-weight:600; color:var(--primary);">${ex.exam_name}</div>
                    <div style="font-size:13px; color:var(--text-muted); margin-top:4px;">
                        ${new Date(ex.scheduled_at).toLocaleString()} ‚Ä¢ ${ex.duration_minutes} mins
                    </div>
                </div>`).join('') : '<div style="padding:20px; text-align:center; color:#94a3b8;">No exams scheduled</div>';
            document.getElementById('modal-body').innerHTML = html;
        }

        async function openHistory() {
            showModal('üìú Past Results', 'Loading...');
            const { data } = await supabase.from('exam_history').select('*').eq('student_roll', currentUser.roll_no).order('created_at', {ascending: false});
            const html = (data && data.length) ? data.map(h => `
                <div class="list-item">
                    <div style="display:flex; justify-content:space-between;">
                        <strong>${h.exam_name}</strong>
                        <span style="font-weight:bold; color:${h.score/h.total_marks>=0.4?'var(--success)':'var(--danger)'}">${h.score}/${h.total_marks}</span>
                    </div>
                    <div style="font-size:12px; color:#94a3b8;">${new Date(h.created_at).toLocaleDateString()}</div>
                </div>`).join('') : '<div style="padding:20px; text-align:center; color:#94a3b8;">No history found</div>';
            document.getElementById('modal-body').innerHTML = html;
        }

        function switchView(id) { document.querySelectorAll('.view').forEach(el => el.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function showModal(title, content) { document.getElementById('modal-title').innerText = title; document.getElementById('modal-body').innerHTML = content; document.getElementById('modal-list').classList.add('show'); }
        function closeModal() { document.getElementById('modal-list').classList.remove('show'); }
        function showAlert(msg) { return new Promise(r => { document.getElementById('alert-text').innerText = msg; document.getElementById('alert-cancel').style.display = 'none'; document.getElementById('custom-alert').classList.add('show'); document.getElementById('alert-ok').onclick = () => { document.getElementById('custom-alert').classList.remove('show'); r(); }; }); }
        function showConfirm(msg) { return new Promise(r => { document.getElementById('alert-text').innerText = msg; document.getElementById('alert-cancel').style.display = 'inline-block'; document.getElementById('custom-alert').classList.add('show'); document.getElementById('alert-ok').onclick = () => { document.getElementById('custom-alert').classList.remove('show'); r(true); }; document.getElementById('alert-cancel').onclick = () => { document.getElementById('custom-alert').classList.remove('show'); r(false); }; }); }
    </script>
</body>
</html>
